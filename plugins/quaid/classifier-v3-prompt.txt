Extract memorable facts from this message for a personal knowledge base.

${isAssistantMessage ? 
  `Speaker: Alfie (assistant)
Message: "${text.slice(0, 500)}"

CRITICAL ATTRIBUTION RULES:
- Extract facts ABOUT the user (Solomon), NOT about the assistant
- "Your dogs are..." → "Solomon's dogs are..."
- "Your email is..." → "Solomon's email is..."  
- "You prefer..." → "Solomon prefers..."
- NEVER capture: "Alfie says...", "Alfie thinks...", "Alfie will..."
- NEVER capture: Assistant opinions, system status, or implementation details
- ONLY capture: User facts revealed through assistant responses` :
  `Speaker: ${speaker}
Message: "${text.slice(0, 500)}"`
}

CAPTURE ONLY these fact types:
- **Personal facts**: Names, relationships, jobs, birthdays, health conditions, addresses
- **Preferences**: Likes, dislikes, favorites, opinions, communication styles
- **Project facts**: Names, tech stack, goals, milestones, decisions with reasoning
- **Instructions**: "Always do X", "Never Y", "I prefer Z format" (permanent rules)
- **Important relationships**: Staff, contacts, business partners
- **Significant events**: Major life changes, health diagnoses, big decisions

NOISE PATTERNS - NEVER CAPTURE:
- **Conversational fragments**: Questions ("Should I...?"), suggestions ("Maybe we could..."), worries ("I'm concerned that...")
- **System/technical noise**: Plugin file paths, debugging events, error messages, system states
- **Entity stubs**: Single words, camera names, room names, device IDs without context
- **Meta-conversation**: Discussion about Alfie's systems, memory, capabilities, development
- **Temporal work-in-progress**: "working on", "about to", "planning to", "will do", "going to"
- **Commands/requests**: "Alfie should...", "Alfie needs to...", "Can you...", "Please..."
- **Already documented**: Facts that would be in static files like USER.md, TOOLS.md, AGENTS.md
- **Duplicates**: Information already well-established (check for obvious repetition)
- **Acknowledgments**: "Thanks", "Got it", "Sounds good", "Perfect", "OK"
- **General knowledge**: Facts not specific to this person/household

QUALITY FILTERS:
- **Completeness**: Skip partial facts like "Solomon's mother" without name/context
- **Specificity**: "Solomon likes spicy food" > "Solomon likes food"  
- **Stability**: Permanent/semi-permanent facts > temporary states
- **Uniqueness**: Personal details > common knowledge
- **Attribution confidence**: Clear speaker context required

COMMON PITFALLS FROM REVIEW:
❌ "Alfie's mother/pets/house" (wrong attribution)
❌ "Router reboots daily at 3am" (system config, temporary)
❌ "Solomon suggested we try..." (conversational fragment)
❌ "Working on the memory system" (temporal work status)
❌ "plugins/quaid/file.py" (technical noise)
❌ "Master Bedroom" (entity stub without context)
❌ "Nemesis" (missing context - game? movie? what?)

EXAMPLE GOOD vs BAD:
✅ GOOD: "Solomon's favorite board game is Nemesis"
✅ GOOD: "Solomon's elimination diet excludes wheat, eggs, soy, nuts, dairy, fish"
✅ GOOD: "Solomon's mother Wendy cannot tolerate any spice due to childhood lye exposure"
❌ BAD: "Alfie's memory system works perfectly"
❌ BAD: "Solomon wants to fix the router issue"  
❌ BAD: "The user prefers concise responses"
❌ BAD: "Checking the calendar for events"

Extract facts as SPECIFIC, COMPLETE statements in THIRD PERSON using "${actualSubject}" as subject.

${isAssistantMessage ? 
  `Convert assistant references: "Your X" → "${actualSubject}'s X", "You have Y" → "${actualSubject} has Y"` :
  `Always rephrase "I/my/me" to "${actualSubject}".`
}

Respond with JSON only:
{"facts": ["specific fact 1", "specific fact 2"], "category": "fact|preference|decision|relationship|instruction", "confidence": "high|medium|low"}